<meta charset="utf-8" />
<title>å­—ç¬¦è®¡æ•°</title>
<link
  rel="stylesheet"
  href="https://cdn.staticfile.org/reveal.js/4.1.0/reveal.min.css"
/>
<link
  rel="stylesheet"
  href="https://cdn.staticfile.org/reveal.js/4.1.0/theme/black.min.css"
/>
<link
  rel="stylesheet"
  href="https://cdn.staticfile.org/reveal.js/4.1.0/plugin/highlight/monokai.css"
/>
<link rel="stylesheet" href="../override.css" />

<body class="reveal">
  <section class="slides">
    <section>
      <h1>å­—ç¬¦è®¡æ•°</h1>
      <p>å‰ç«¯å·¥ç¨‹å¸ˆéœ€è¦äº†è§£çš„ Unicode çŸ¥è¯†</p>
    </section>
    <section>
      <h2>ä¸è¶…è¿‡ 20 ä¸ªå­—ç¬¦</h2>
      <code class="fragment" data-fragment-index="0">str.length <= 20</code>
    </section>
    <section>
      <section>
        <h2><code>length</code> æ˜¯å¦‚ä½•å®šä¹‰çš„ï¼Ÿ</h2>
      </section>
      <section>
        <code>"ğŸ˜‚".length</code>
      </section>
      <section>
        <div class="fragment" data-fragment-index="0">
          <q>
            The String type is the set of all ordered sequences of zero or more
            16-bit unsigned integer values (â€œelementsâ€) up to a maximum length
            of 2<sup>53</sup> - 1 elements.
          </q>
          <p style="text-align: right">
            <a
              href="https://262.ecma-international.org/11.0/#sec-ecmascript-language-types-string-type"
              >â€”â€”6.1.4 The String Type</a
            >
          </p>
        </div>
        <div class="fragment" data-fragment-index="1">
          <q>
            The number of elements in the String value represented by this
            String object.
          </q>
          <p style="text-align: right">
            <a
              href="https://262.ecma-international.org/11.0/#sec-properties-of-string-instances-length"
              >â€”â€”21.1.4.1 length</a
            >
          </p>
        </div>
      </section>
      <section>
        <p><code>length</code> å±æ€§è¡¨ç¤º 16bit å•å…ƒçš„ä¸ªæ•°</p>
      </section>
      <section>
        <p>ä¸ºä»€ä¹ˆæœ‰äº›å­—ç¬¦å ç”¨ 16bit</p>
        <p>è€Œæœ‰äº›å­—ç¬¦å ç”¨ 32bit</p>
      </section>
      <section>
        <p>UTF-16 ç¼–ç ä¸ä»£ç†å¯¹</p>
      </section>
      <section>
        <p>
          Unicode ç›®å‰å…±å®šä¹‰äº† 0x10FFFF ä¸ªç ç‚¹ã€‚å…¶ä¸­ 0x0000 - 0xFFFF
          æ”¶å½•äº†å„å›½è¯­è¨€ä¸­æœ€å¸¸ç”¨çš„æ–‡å­—å’Œç¬¦å·ï¼Œç§°ä¸º<em>åŸºæœ¬å¤šè¯­ç§å¹³é¢</em>ã€‚
        </p>
        <p>
          0x010000 - 0x10FFFF
          ç§°ä¸º<em>æ‰©å±•å¹³é¢</em>ï¼Œç”¨æ¥æ”¶å½•ä½¿ç”¨é¢‘ç‡è¾ƒä½çš„å­—ç¬¦ã€‚
        </p>
        <a
          href="https://zh.wikipedia.org/wiki/Unicode%E5%AD%97%E7%AC%A6%E5%B9%B3%E9%9D%A2%E6%98%A0%E5%B0%84"
          >Unicodeå­—ç¬¦å¹³é¢æ˜ å°„</a
        >
      </section>
      <section>
        <p>
          UTF-16 æ˜¯ä¸€ç§å˜é•¿ç¼–ç ã€‚å¯¹äºåŸºæœ¬å¤šè¯­ç§å¹³é¢å†…çš„ç ç‚¹ä½¿ç”¨ 16
          ä½è¡¨ç¤ºï¼Œè€Œå¯¹äºæ‰©å±•å¹³é¢å†…çš„ç ç‚¹åˆ™éœ€è¦é€šè¿‡<em>ä»£ç†å¯¹</em>æŠ€æœ¯ä½¿ç”¨ 32
          ä½æ¥è¡¨ç¤ºã€‚
        </p>
      </section>
      <section>
        <p>
          ä»£ç†å¯¹æŠ€æœ¯æ˜¯ä½¿ç”¨åŸºæœ¬å¤šæ–‡ç§å¹³é¢ä¸­é¢„ç•™çš„ 2048 ä¸ªç ä½ï¼ˆ0xD800 -
          0xDFFFï¼‰ï¼Œé€šè¿‡ 2 ä¸ª 16bit ä½ç½®æ¥è¡¨ç¤ºä¸€ä¸ªä½äºæ‰©å±•å¹³é¢ä¸­å­—ç¬¦çš„æŠ€æœ¯ã€‚
        </p>
        <p>
          2048 ä¸ªç ä½ä¸­ 0xD800 - 0xDBFF è¡¨ç¤º<a
            href="https://unicode-table.com/cn/blocks/high-surrogates/"
            >ä»£ç†å¯¹é«˜ä½</a
          >ï¼Œ0xDC00 - 0xDFFF è¡¨ç¤º<a
            href="https://unicode-table.com/cn/blocks/low-surrogates/"
            >ä»£ç†å¯¹ä½ä½</a
          >
        </p>
      </section>
      <section>
        <p>è½¬æ¢è§„åˆ™</p>
        <pre class="fragment" data-fragment-index="0"><code data-trim>
          // ç ç‚¹è½¬ä»£ç†å¯¹
          é«˜ä½ = Math.floor((ç ç‚¹ - 0x010000) / 1024) + 0xD800
          ä½ä½ = (ç ç‚¹ - 0x010000) % 1024 + 0xDC00
        </code></pre>
        <pre class="fragment" data-fragment-index="1"><code data-trim>
          // ä»£ç†å¯¹è½¬ç ç‚¹
          ç ç‚¹ = (é«˜ä½ - 0xD800) * 1024 + (ä½ä½ - 0xDC00) + 0x010000
        </code></pre>
      </section>
      <section>
        <p>JavaScript ä¸­è·å¾—å­—ç¬¦ä¸²çš„ Unicode å­—ç¬¦æ•°</p>
        <pre><code data-trim data-no-escape>
          function countUnicodeCharacters (str) {
            let result = 0;
            for (let i = 0; i < str.length; i++) {
              const charCode = str.charCodeAt(i);
              if (charCode < 0xDC00 || charCode > 0xDFFF) {
                result ++
              }
            }
            return result;
          }
        </code></pre>
      </section>
      <section>
        <p>å¤ªéº»çƒ¦ï¼Ÿ</p>
      </section>
      <section>
        <p>
          ECMAScript 2015
          <a
            href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String/@@iterator"
            ><code>String.prototype[@@iterator]()</code></a
          >
        </p>
      </section>
      <section>
        <code>[...str].length <= 20</code>
      </section>
    </section>
    <section>
      <section data-auto-animate>
        <span style="display: inline-block" data-id="end">å®Œ</span>
      </section>
      <section data-auto-animate>
        <span style="display: inline-block" data-id="end">å®Œ</span
        ><span style="display: inline-block">äº†å—ï¼Ÿ</span>
      </section>
    </section>
    <section>
      <section>
        <h2>ä¸€ä¸ªå¯è§å­—ç¬¦å°±å¯¹åº”ä¸€ä¸ªç ç‚¹å—ï¼Ÿ</h2>
      </section>
      <section data-auto-animate>
        <div data-id="first">
          <code>[..."cafÃ©"].length</code>
        </div>
      </section>
      <section data-auto-animate>
        <div data-id="first">
          <code>[..."cafÃ©"].length</code>
        </div>
        <p>vs.</p>
        <code>[..."cafeÌ"].length</code>
      </section>
      <section>
        <a
          href="https://zh.wikipedia.org/wiki/%E7%B5%84%E5%90%88%E5%AD%97%E7%AC%A6"
          ><h2>ç»„åˆå­—ç¬¦</h2></a
        >
        <code>eÍ(U+00e9) = e(U+0065) + Â´(U+0301)</code>
      </section>
      <section>
        <a
          href="https://zh.wikipedia.org/wiki/Unicode%E7%AD%89%E5%83%B9%E6%80%A7"
          ><h2>Unicode ç­‰ä»·æ€§</h2></a
        >
        <p class="fragment" data-fragment-index="0">
          ä¸¤ä¸ªä¸åŒçš„ Unicode åºåˆ—è¡¨è¾¾äº†ç›¸åŒçš„å«ä¹‰ï¼Œæˆ‘ä»¬å°±è¯´å®ƒä»¬æ˜¯ç­‰ä»·çš„ã€‚
        </p>
      </section>
      <section>
        <h2>Unicode æ­£è§„åŒ–</h2>
        <p class="fragment" data-fragment-index="0">
          å°†å½¼æ­¤ç­‰ä»·çš„åºåˆ—è½¬æˆåŒä¸€åˆ—åºçš„æ“ä½œè¢«ç§°ä¸º Unicode æ­£è§„åŒ–ï¼ˆUnicode
          Normalizeï¼‰ã€‚
        </p>
        <p class="fragment" data-fragment-index="1">
          æ­£è§„åŒ–å¾—åˆ°çš„åºåˆ—åœ¨ Unicode æ ‡å‡†ä¸­ç§°ä½œæ­£è§„å½¢å¼ã€‚
        </p>
        <p class="fragment" data-fragment-index="2">
          ES 2015+ ä¸­å¯ä»¥ä½¿ç”¨ <code>String.prototype.normalize()</code> æ–¹æ³•ã€‚
        </p>
      </section>
      <section>
        <h2>æ­£è§„å½¢å¼</h2>
        <ul>
          <li>NFDï¼šæ ‡å‡†ç­‰ä»·åˆ†è§£æ¨¡å¼ï¼šç”¨å°½å¯èƒ½å¤šçš„å­—èŠ‚ï¼ˆbyteï¼‰æ¥ä»£è¡¨å­—ç¬¦ã€‚</li>
          <li>NFCï¼šæ ‡å‡†ç­‰ä»·ç»„åˆæ¨¡å¼ï¼šç”¨å°½å¯èƒ½å°‘çš„å­—èŠ‚ï¼ˆbyteï¼‰æ¥ä»£è¡¨å­—ç¬¦ã€‚</li>
        </ul>
      </section>
      <section>
        <h2>DEMO</h2>
        <p>åºåˆ— <code>cafÃ©</code> çš„æ­£è§„å½¢å¼</p>
      </section>
      <section>
        <code>[...str.normalize()].length <= 20</code>
      </section>
    </section>
    <section>
      <section data-auto-animate>
        <span style="display: inline-block" data-id="end">å®Œ</span>
      </section>
      <section data-auto-animate>
        <span style="display: inline-block">è¿˜æ²¡</span
        ><span style="display: inline-block" data-id="end">å®Œ</span>
      </section>
    </section>
    <section>
      <section>
        <code>[..."ğŸ‘¨â€ğŸ‘©â€ğŸ‘¦".normalize()].length</code>
      </section>
      <section>
        <a
          href="https://zh.wikipedia.org/wiki/%E9%9B%B6%E5%AE%BD%E8%BF%9E%E5%AD%97"
          ><h2>é›¶å®½è¿å­—ç¬¦ï¼ˆZWJï¼‰</h2></a
        >
        <code
          >ğŸ‘¨â€ğŸ‘©â€ğŸ‘¦ = ğŸ‘¨(U+1F468) + [ZWJ](U+200D) + ğŸ‘©(U+1F469) + [ZWJ](U+200D) +
          ğŸ‘¦(U+1F466)</code
        >
      </section>
      <section>
        <code>[..."ğŸ‘ğŸ»ğŸ‘ğŸ¼ğŸ‘ğŸ½ğŸ‘ğŸ¾ğŸ‘ğŸ¿".normalize()].length</code>
      </section>
      <section>
        <a href="https://unicode-table.com/cn/emoji/component/skin-tone/"
          ><h2>è‚¤è‰²ä¿®é¥°ç¬¦</h2></a
        >
        <code
          >ğŸ‘ğŸ¿ = ğŸ‘(U+1F44D) + [Emoji Modifier Fitzpatrick Type-6](U+1F3FF)</code
        >
      </section>
      <section>
        <h2>ğŸ¤¦â€â™‚ï¸</h2>
      </section>
    </section>
    <section data-visibility="hidden">
      <section>
        <p>å…¶å®éƒ½æ˜¯ JavaScript çš„é”…</p>
      </section>
      <section>
        <h2>Python</h2>
        <pre><code data-trim data-no-escape>
          len("ğŸ¤£")
          // 1

          len("ğŸ‘¨â€ğŸ‘©â€ğŸ‘¦")
          // 5
        </code></pre>
      </section>
      <section>
        <h2>Swift</h2>
        <pre><code data-trim data-no-escape>
          "ğŸ¤£".count
          // 1

          "ğŸ‘¨â€ğŸ‘©â€ğŸ‘¦".count
          // 1
        </code></pre>
      </section>
    </section>
    <section>
      <h1>å®Œ</h1>
    </section>
  </section>
</body>

<script type="module">
  import Reveal from "https://cdn.staticfile.org/reveal.js/4.1.0/reveal.esm.min.js";
  import Markdown from "https://cdn.staticfile.org/reveal.js/4.1.0/plugin/markdown/markdown.esm.min.js";
  import Highlight from "https://cdn.staticfile.org/reveal.js/4.1.0/plugin/highlight/highlight.esm.min.js";

  new Reveal({
    hash: true,
    hashOneBasedIndex: true,
    navigationMode: "linear",
    plugins: [Markdown, Highlight],
  }).initialize();
</script>
